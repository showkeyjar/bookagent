<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookAgent - 智能技术图书自动生成系统</title>
    <link href="https://cdn.tailwindcss.com" rel="stylesheet">
    <script>
        // 等待Tailwind加载完成
        function initTailwind() {
            if (typeof tailwind !== 'undefined') {
                tailwind.config = {
                    theme: {
                        extend: {
                            colors: {
                                primary: '#3b82f6',
                                secondary: '#6b7280',
                                accent: '#10b981',
                            },
                            fontFamily: {
                                inter: ['Inter', 'sans-serif'],
                            },
                        }
                    }
                }
            } else {
                // 如果Tailwind未加载，100毫秒后重试
                setTimeout(initTailwind, 100);
            }
        }
        // 启动初始化
        initTailwind();
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .book-card {
                @apply transition-all duration-300 hover:shadow-lg hover:-translate-y-1;
            }
            .btn-primary {
                @apply bg-primary text-white px-4 py-2 rounded-md hover:bg-primary/90 transition-colors;
            }
            .btn-secondary {
                @apply bg-secondary text-white px-4 py-2 rounded-md hover:bg-secondary/90 transition-colors;
            }
        }
    </style>
    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        .book-card {
            transition: transform 0.3s ease;
        }
        .book-card:hover {
            transform: translateY(-5px);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
    <header class="bg-blue-600 text-white shadow-md">
        <div class="container mx-auto py-4 px-6 flex justify-between items-center">
            <h1 class="text-2xl font-bold">BookAgent</h1>
            <nav>
                <ul class="flex space-x-6">
                    <li><a href="#" class="hover:text-blue-200">首页</a></li>
                    <li><a href="#books" class="hover:text-blue-200">书籍</a></li>
                    <li><a href="#templates" class="hover:text-blue-200">模板</a></li>
                    <li><a href="#generate" class="hover:text-blue-200">生成</a></li>
                    <li><a href="#about" class="hover:text-blue-200">关于</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="flex-grow container mx-auto py-8 px-6">
        <section id="hero" class="mb-16 text-center">
            <h2 class="text-4xl font-bold mb-4 text-gray-800">智能技术图书自动生成系统</h2>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto">轻松创建专业的技术图书，从大纲到章节内容，一键生成。</p>
            <button id="get-started" class="mt-8 bg-blue-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors">
                开始使用
            </button>
        </section>

        <section id="books" class="mb-16">
            <h2 class="text-3xl font-bold mb-8 text-center text-gray-800">已生成书籍</h2>
            <div id="books-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- 书籍卡片将通过JavaScript动态加载 -->
                <div class="book-card bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="p-6">
                        <h3 class="text-xl font-bold mb-2 text-gray-800">加载中...</h3>
                        <p class="text-gray-600 mb-4">正在获取书籍列表...</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="templates" class="mb-16">
            <h2 class="text-3xl font-bold mb-8 text-center text-gray-800">可用模板</h2>
            <div id="templates-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- 模板卡片将通过JavaScript动态加载 -->
                <div class="book-card bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="p-6">
                        <h3 class="text-xl font-bold mb-2 text-gray-800">加载中...</h3>
                        <p class="text-gray-600 mb-4">正在获取模板列表...</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="generate" class="mb-16 bg-white rounded-lg shadow-md p-8">
            <h2 class="text-3xl font-bold mb-8 text-center text-gray-800">生成新书籍</h2>
            <form id="generate-form" class="max-w-2xl mx-auto">
                <div class="mb-6">
                    <label for="book-title" class="block text-gray-700 mb-2 font-medium">书籍标题</label>
                    <input type="text" id="book-title" name="title" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <div class="mb-6">
                    <label for="book-description" class="block text-gray-700 mb-2 font-medium">书籍描述</label>
                    <textarea id="book-description" name="description" rows="4"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                </div>

                <div class="mb-6">
                    <label for="template-id" class="block text-gray-700 mb-2 font-medium">选择模板</label>
                    <select id="template-id" name="template_id"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">加载中...</option>
                    </select>
                </div>

                <div class="mb-6">
                    <label for="chapter-count" class="block text-gray-700 mb-2 font-medium">章节数量</label>
                    <input type="number" id="chapter-count" name="chapter_count" min="1" max="20" value="5"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <button type="submit" class="btn-primary w-full md:w-auto">生成书籍</button>
            </form>
        </section>
    </main>

    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-6 text-center">
            <p>© 2025 BookAgent - 智能技术图书自动生成系统</p>
            <p class="mt-2 text-gray-400">API文档: <a href="/api/docs" class="text-blue-300 hover:underline">/api/docs</a></p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // API基础URL
            const API_BASE_URL = '/api/v1';

            // 获取并显示书籍列表
            function loadBooks() {
                fetch(`${API_BASE_URL}/books`)
                    .then(response => response.json())
                    .then(data => {
                        const booksContainer = document.getElementById('books-container');
                        booksContainer.innerHTML = '';

                        // 确保books是数组
                        const books = Array.isArray(data) ? data : [];

                        if (books.length === 0) {
                            booksContainer.innerHTML = `
                                <div class="col-span-full text-center py-12">
                                    <p class="text-gray-500 text-xl">暂无书籍，请先生成新书</p>
                                </div>
                            `;
                            return;
                        }

                        books.forEach(book => {
                            const bookCard = document.createElement('div');
                            bookCard.className = 'book-card bg-white rounded-lg shadow-md overflow-hidden';
                            bookCard.innerHTML = `
                                <div class="p-6">
                                    <h3 class="text-xl font-bold mb-2 text-gray-800">${book.title || '未知标题'}</h3>
                                    <p class="text-gray-600 mb-4">${book.description || '暂无描述'}</p>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-500">章节数: ${book.chapter_count || '0'}</span>
                                        <button class="view-book-btn bg-blue-500 text-white px-4 py-1 rounded hover:bg-blue-600 transition-colors"
                                            data-id="${book.id || ''}">查看详情</button>
                                    </div>
                                </div>
                            `;
                            booksContainer.appendChild(bookCard);
                        });

                        // 添加查看详情按钮事件
                        document.querySelectorAll('.view-book-btn').forEach(btn => {
                            btn.addEventListener('click', function() {
                                const bookId = this.getAttribute('data-id');
                                alert(`查看书籍ID: ${bookId} 的详情`);
                                // 这里可以实现跳转到书籍详情页的逻辑
                            });
                        });
                    })
                    .catch(error => {
                        console.error('加载书籍失败:', error);
                        document.getElementById('books-container').innerHTML = `
                            <div class="col-span-full text-center py-12">
                                <p class="text-red-500 text-xl">加载书籍失败: ${error.message}</p>
                            </div>
                        `;
                    });
            }

            // 获取并显示模板列表
            function loadTemplates() {
                fetch(`${API_BASE_URL}/templates`)
                    .then(response => response.json())
                    .then(data => {
                        const templatesContainer = document.getElementById('templates-container');
                        const templateSelect = document.getElementById('template-id');

                        templatesContainer.innerHTML = '';
                        templateSelect.innerHTML = '<option value="">请选择模板</option>';

                        // 确保templates是数组
                        const templates = Array.isArray(data) ? data : [];

                        if (templates.length === 0) {
                            templatesContainer.innerHTML = `
                                <div class="col-span-full text-center py-12">
                                    <p class="text-gray-500 text-xl">暂无模板</p>
                                </div>
                            `;
                            templateSelect.innerHTML = '<option value="">暂无模板</option>';
                            return;
                        }

                        templates.forEach(template => {
                            // 添加到模板列表
                            const templateCard = document.createElement('div');
                            templateCard.className = 'book-card bg-white rounded-lg shadow-md overflow-hidden';
                            templateCard.innerHTML = `
                                <div class="p-6">
                                    <h3 class="text-xl font-bold mb-2 text-gray-800">${template.name || '未知模板'}</h3>
                                    <p class="text-gray-600 mb-4">${template.description || '暂无描述'}</p>
                                    <div class="flex justify-end">
                                        <button class="select-template-btn bg-blue-500 text-white px-4 py-1 rounded hover:bg-blue-600 transition-colors"
                                            data-id="${template.id || ''}">选择</button>
                                    </div>
                                </div>
                            `;
                            templatesContainer.appendChild(templateCard);

                            // 添加到下拉菜单
                            const option = document.createElement('option');
                            option.value = template.id || '';
                            option.textContent = template.name || '未知模板';
                            templateSelect.appendChild(option);
                        });

                        // 添加选择模板按钮事件
                        document.querySelectorAll('.select-template-btn').forEach(btn => {
                            btn.addEventListener('click', function() {
                                const templateId = this.getAttribute('data-id');
                                document.getElementById('template-id').value = templateId;
                            });
                        });
                    })
                    .catch(error => {
                        console.error('加载模板失败:', error);
                        document.getElementById('templates-container').innerHTML = `
                            <div class="col-span-full text-center py-12">
                                <p class="text-red-500 text-xl">加载模板失败: ${error.message}</p>
                            </div>
                        `;
                        const templateSelect = document.getElementById('template-id');
                        if (templateSelect) {
                            templateSelect.innerHTML = '<option value="">加载模板失败</option>';
                        }
                    });
            }

            // 生成书籍表单提交事件
            document.getElementById('generate-form')?.addEventListener('submit', function(e) {
                e.preventDefault();
                const title = document.getElementById('book-title')?.value;
                const description = document.getElementById('book-description')?.value;
                const templateId = document.getElementById('template-id')?.value;
                const chapterCount = document.getElementById('chapter-count')?.value;

                if (!title || !templateId) {
                    alert('请填写书籍标题并选择模板');
                    return;
                }

                const bookData = {
                    title: title,
                    description: description,
                    template_id: templateId,
                    chapter_count: chapterCount
                };

                // 显示加载状态
                const submitBtn = this.querySelector('button[type="submit"]');
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.textContent = '生成中...';
                }

                fetch(`${API_BASE_URL}/books`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(bookData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP错误! 状态码: ${response.status}`);
                    }
                    return response.json();
                })
                .then(book => {
                    alert(`书籍《${book.title || '未知标题'}》生成成功！`);
                    // 重置表单
                    this.reset();
                    // 重新加载书籍列表
                    loadBooks();
                })
                .catch(error => {
                    console.error('生成书籍失败:', error);
                    alert(`生成书籍失败: ${error.message || '未知错误'}`);
                })
                .finally(() => {
                    // 恢复按钮状态
                    if (submitBtn) {
                        submitBtn.disabled = false;
                        submitBtn.textContent = '生成书籍';
                    }
                });
            });

            // 开始使用按钮点击事件
            document.getElementById('get-started').addEventListener('click', function() {
                document.getElementById('generate').scrollIntoView({ behavior: 'smooth' });
            });

            // 初始加载数据
            loadBooks();
            loadTemplates();
        });
    </script>
</body>
</html>